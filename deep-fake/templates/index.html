<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Deep Fake</title>
        <style>
        html, body {
   font-family: 'helvetica neue', 'arial', sans-serif;
   padding: 0;
   margin: 0;
   width: 100%;
   height: 100%;
}


main{
    max-width: 80rem;
    display: flex;
}

h1{
    font-size: 4rem;
}

.upload {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.result{
    padding: 2rem;
    width: 40rem;
}

.file-upload {
	position: relative;
	display: inline-block;
}

.file-upload__label {
  display: block;
  padding: 1em 2em;
  color: #fff;
  background: rgb(0, 99, 8);
  border-radius: .4em;
  transition: background .3s;
  cursor: pointer;
  max-width: 200px;
  text-align: center;
  font-weight: bold;

  /* &:hover {
     cursor: pointer;
     background: #000;
  } */
}

.file-upload__input {
    text-align: center;
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    font-size: 2rem;
    width:0;
    height: 100%;
    opacity: 0;
}

.lds-circle {
  display: inline-block;
  transform: translateZ(1px);
}
.lds-circle > div {
  display: inline-block;
  width: 51px;
  height: 51px;
  margin: 6px;
  border-radius: 50%;
  background: #fff;
  animation: lds-circle 2.4s cubic-bezier(0, 0.2, 0.8, 1) infinite;
}
@keyframes lds-circle {
  0%, 100% {
    animation-timing-function: cubic-bezier(0.5, 0, 1, 0.5);
  }
  0% {
    transform: rotateY(0deg);
  }
  50% {
    transform: rotateY(1800deg);
    animation-timing-function: cubic-bezier(0, 0.5, 0.5, 1);
  }
  100% {
    transform: rotateY(3600deg);
  }
}

    </style>
    </head>
    <body>
        <div id="not-hotdog" class="upload">
            <b id="error" style="display:none; margin-bottom: 32px; color:red">Could not recognize the face</b>
            <div class="file-upload">
                <label
                    for="upload"
                    class="file-upload__label"
                >
                    <span id="upload-text">Upload image to apply military filters</span>
                    <div style="display:none" id="upload-loader" class="lds-circle"><div></div></div>
                </label>
                <input id="upload" onchange="fileUploaded(event)" class="file-upload__input" type="file" name="upload">
            </div>
            <img id="hello-world" src=""></img>
        </div>
    <script>
        document.getElementById('upload-text').innerText = document.getElementById('upload-text').innerText.toLocaleUpperCase();

        function setImage(base64) {
            document.getElementById('hello-world').src = base64;
        }

        function switchImages(images) {
            let i = 1;

            const imageInterval = setInterval(() => {
                setImage(images[i])
                i += 1;
                if (i === images.length) clearInterval(imageInterval);
            }, 4000)
            setImage(images[0])
        }


        function fileUploaded(event) {
            document.getElementById('upload-loader').style.display = 'inline-block';
            document.getElementById('upload-text').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            const file = event.target.files[0];
            var reader  = new FileReader();

            reader.addEventListener("load", async function () {
                const result =  await fetch('/api/image', {
                    method: 'POST',
                    body: reader.result,
                    headers: new Headers({
                        'content-type': 'text/plain'
                    })
                });

                document.getElementById('not-hotdog').style.display = 'none';
                if (result.ok) {
                    const images = await result.json();

                    switchImages(images)
                } else {
                    document.getElementById('not-hotdog').style.display = 'flex';
                    document.getElementById('upload-loader').style.display = 'none';
                    document.getElementById('upload-text').style.display = 'inline-block';
                    document.getElementById('error').style.display = 'inline-block';
                }

            }, false);

            if (file) {
                reader.readAsDataURL(file);
            }
        }
    </script>
    </body>
</html>
